<template>
  <div>
    <drawVue
      :nodes="nodes"
      :toolbar="['undo', 'redo']"
      :outlineMap="true"
      ref="draw"
      :beforeAddVertex="beforeAddVertex"
    >
      <!-- <template #sidebar>asdasdasd</template> -->
    </drawVue>
  </div>
</template>

<script setup lang="ts">
import { mxCell } from 'mxgraph'
import { onMounted, ref } from 'vue'
import drawVue from './package/draw.vue'
import mx from './package/factory'
import { SidebarNode, SidebarNodeConfig } from './package/type/type'
import './shape'
const nodes = ref<SidebarNode[]>([])
const draw = ref()
mx.mxConnectionHandler.prototype.connect = function (
  source: mxCell,
  target: mxCell,
  evt: MouseEvent,
  dropTarget: mxCell
) {
  console.log('1111')
  this.originConnect.apply(this, arguments as any)
}
onMounted(() => {
  nodes.value = [
    {
      name: '类型1',
      nodes: [
        {
          name: '能力域1233123123123123',
          style: 'shape=swimlane;',
          value: '111',
          type: 'vertex',
          width: 180,
          height: 180,
          info: {
            name: '能力域',
            nodeType: 'ability_field'
          }
        },
        {
          name: '能力域123123123123',
          style: 'shape=rectangle;',
          value: '111',
          type: 'vertex',
          width: 180,
          height: 180,
          info: {
            name: '能力域',
            nodeType: 'ability_field'
          }
        }
      ],
      children: [
        {
          name: '类型3',
          nodes: [
            {
              name: '撒大苏打',
              style: 'rounded=1;',
              value: '111777777',
              type: 'vertex',
              width: 100,
              height: 100
            }
          ]
        }
      ]
    },
    {
      name: '类型2',
      nodes: [
        {
          name: '撒大苏打',
          style: 'rounded=1;',
          type: 'vertex',
          width: 100,
          height: 100
        }
      ]
    }
  ]
  const graph = draw.value.graph

  var v1 = graph.insertVertex(
    graph.defaultParent,
    null,
    'Hello,',
    20,
    20,
    80,
    30
  )
  var v2 = graph.insertVertex(
    graph.defaultParent,
    null,
    'World!',
    200,
    150,
    80,
    30
  )
  var e1 = graph.insertEdge(graph.defaultParent, null, '', v1, v2)
})
const beforeAddVertex = (cell: mxCell) => {
  return true
}
// 类型1: [
//       {
//         name: '能力域123',
//         style: 'shape=rectangle;',
//         value: '111',
//         type: 'vertex',
//         width: 180,
//         height: 180,
//         info: {
//           name: '能力域',
//           nodeType: 'ability_field'
//         }
//       }
//     ],
//     类型2: [
//       {
//         name: '撒大苏打',
//         style: 'rounded=1;',
//         type: 'vertex',
//         width: 100,
//         height: 100
//       }
//     ]
</script>

<style scoped></style>
